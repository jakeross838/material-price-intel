---
phase: 10-estimating-procurement
plan: 08
type: execute
wave: 8
depends_on: ["10-07"]
files_modified:
  - material-price-intel/src/pages/DashboardPage.tsx
  - material-price-intel/src/pages/ProjectsListPage.tsx
  - material-price-intel/src/pages/ProjectDetailPage.tsx
  - material-price-intel/src/components/projects/ProjectEditModal.tsx
autonomous: false

must_haves:
  truths:
    - "Dashboard shows active projects with budget status"
    - "Project list shows budget health indicators"
    - "User can edit project details (name, client, dates, budget)"
    - "All Phase 10 features work end-to-end"
    - "No regressions on existing price intelligence features"
  artifacts:
    - path: "material-price-intel/src/components/projects/ProjectEditModal.tsx"
      provides: "Modal for editing project details"
      min_lines: 60
  key_links:
    - from: "material-price-intel/src/pages/DashboardPage.tsx"
      to: "projects table"
      via: "Query for active projects"
      pattern: "from.*projects"
    - from: "material-price-intel/src/pages/ProjectsListPage.tsx"
      to: "get_project_summary RPC"
      via: "Budget summary per project"
      pattern: "get_project_summary"
---

<objective>
Polish and integrate Phase 10 features with the existing app: Dashboard project summary, project editing, and end-to-end verification.

Purpose: The final plan ties everything together -- making projects visible on the Dashboard, enabling project editing, and verifying the complete workflow from project creation through procurement.

Output: Updated Dashboard, enhanced project list, edit modal, and verified end-to-end functionality.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-estimating-procurement/10-01-SUMMARY.md
@.planning/phases/10-estimating-procurement/10-02-SUMMARY.md
@.planning/phases/10-estimating-procurement/10-05-SUMMARY.md
@.planning/phases/10-estimating-procurement/10-06-SUMMARY.md
@.planning/phases/10-estimating-procurement/10-07-SUMMARY.md
@material-price-intel/src/pages/DashboardPage.tsx
@material-price-intel/src/pages/ProjectsListPage.tsx
@material-price-intel/src/pages/ProjectDetailPage.tsx
@material-price-intel/src/hooks/useProjects.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dashboard integration, project list enhancement, and project edit modal</name>
  <files>
    material-price-intel/src/pages/DashboardPage.tsx
    material-price-intel/src/pages/ProjectsListPage.tsx
    material-price-intel/src/components/projects/ProjectEditModal.tsx
    material-price-intel/src/pages/ProjectDetailPage.tsx
  </files>
  <action>
**Update DashboardPage.tsx** - Add an "Active Projects" section below the existing "Needs Attention" section:

- Query projects with status IN ('planning', 'estimating', 'in_progress') ordered by updated_at desc, limit 5
- Display as a Card with a list:
  - Each row: Project name (link to /projects/:id) | Client name | Status badge | Budget summary
  - Budget summary: "Est: $X / Budget: $Y" or "Actual: $X / Budget: $Y"
  - If no projects: "No active projects. Start by creating a project." with link to /projects/new
- Section header: "Active Projects" with "View All" link to /projects

**Update ProjectsListPage.tsx** - Enhance with budget health data:

- For each project in the list, fetch summary data using the get_project_summary RPC
  - Use a separate useQuery for each project (or a bulk query approach)
  - Simpler approach: fetch all projects, then for each one that's displayed, use useMemo to show basic info, and call get_project_summary lazily
  - BEST approach: Just fetch selections counts inline. Add a simple query that counts selections and sums financials per project using a single query.
- Add to each project card:
  - Selection count: "X selections"
  - Budget health: If target_budget exists, show a mini progress bar (total_estimated / target_budget)
  - Variance summary: "+$X,XXX over" or "-$X,XXX under" (colored green/red)
- Add filter controls at top of list:
  - Status filter: All | Planning | Estimating | In Progress | Completed | On Hold
  - Sort: Updated (default) | Name | Budget | Status
- Empty states for filtered views: "No projects match your filters"

**Create ProjectEditModal.tsx** - Edit existing project details:

Props: `{ project: Project, onClose: () => void, onSaved: () => void }`

- Modal overlay (same pattern as QuoteLinkModal from Plan 05)
- Form with all editable project fields:
  - name (text, required)
  - client_name, client_email, client_phone
  - address, city, state
  - square_footage (number)
  - target_budget (number)
  - status (select dropdown with all status options)
  - start_date, estimated_completion (date inputs)
  - notes (textarea)
- Pre-populated with current project values
- "Save" and "Cancel" buttons
- Uses useUpdateProject() mutation
- On success: calls onSaved(), which should invalidate project cache and close modal

**Update ProjectDetailPage.tsx** - Wire up the Edit button:
- Enable the previously-disabled "Edit" button
- Clicking "Edit" opens ProjectEditModal
- On save: project data refreshes
- Also add a "Delete Project" button (in a danger zone area or as a menu option)
  - Confirm via window.confirm("Are you sure? This will delete all rooms, selections, and procurement data.")
  - Uses useDeleteProject mutation
  - On success: navigate to /projects
  </action>
  <verify>
1. `cd material-price-intel && npx tsc --noEmit` passes
2. Dashboard shows active projects section
3. Projects list shows budget health and filtering works
4. Edit modal opens, saves changes, and refreshes data
5. Delete project works with confirmation
6. All existing dashboard functionality still works
  </verify>
  <done>Dashboard integration, enhanced project list with filtering, and project CRUD operations fully functional.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 10: Project Estimating and Procurement system including:
    - Database schema (projects, rooms, selections, procurement tables)
    - Project CRUD (list, create, edit, delete)
    - Room management with presets
    - Selection editing with allowances and quantities
    - Estimate generation from historical price data
    - Procurement/buyout tracking with quote linking
    - Budget vs actual variance dashboard with charts
    - Printable selection sheets for client meetings
    - Dashboard integration with active projects
  </what-built>
  <how-to-verify>
    1. Navigate to Dashboard -- verify "Active Projects" section appears
    2. Click "Projects" in sidebar -- verify projects list page loads
    3. Create a new project:
       - Click "New Project"
       - Fill in: name "Test Home", client "John Smith", address "123 Main St", budget $500,000, sqft 3500
       - Submit and verify redirect to project detail
    4. Add rooms:
       - Use presets to add Kitchen, Master Bath, Great Room
       - Verify rooms appear in left panel
    5. Add selections to Kitchen:
       - Add "Kitchen Flooring" with category Flooring, allowance $5,000, quantity 200 sqft
       - Add "Kitchen Countertops" with category (if available), allowance $8,000
    6. Test estimate builder (if materials exist in database):
       - Assign a material to a selection
       - Click "Get Estimate" -- verify historical pricing shows
       - Click "Use Average" -- verify estimated price populates
    7. Test procurement (if quotes exist in database):
       - Go to Procurement tab
       - Click "Link Quote" on a selection
       - Verify matching quotes appear
    8. Test budget dashboard:
       - Go to Budget tab
       - Verify summary cards show totals
       - Verify chart renders
       - Toggle between room/category views
    9. Test selection sheet:
       - Go to Selection Sheet tab
       - Verify all rooms and selections displayed
       - Toggle "Show Pricing" off and verify dollars hidden
       - Click "Print" and verify clean print preview
    10. Edit project: Click Edit, change client name, save, verify update
    11. Verify no regressions: Navigate to Upload, Quotes, Search, Reports, Materials pages
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Full workflow: Create project -> add rooms -> add selections -> estimate -> procure -> budget review -> print selection sheet
2. Dashboard shows active projects
3. Project list filtering and sorting works
4. Edit and delete operations work
5. No regressions on existing pages (Upload, Quotes, Search, Reports, Materials)
6. `npx tsc --noEmit` passes
7. `npm run build` succeeds
</verification>

<success_criteria>
- Dashboard provides at-a-glance project status
- Projects list shows budget health indicators
- Project editing and deletion work correctly
- End-to-end workflow from project creation through procurement verified by human
- No regressions on phases 1-9 functionality
- Build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-estimating-procurement/10-08-SUMMARY.md`
</output>
