---
phase: 10-estimating-procurement
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - material-price-intel/src/hooks/useProjects.ts
  - material-price-intel/src/pages/ProjectsListPage.tsx
  - material-price-intel/src/pages/ProjectCreatePage.tsx
  - material-price-intel/src/pages/ProjectDetailPage.tsx
  - material-price-intel/src/App.tsx
  - material-price-intel/src/components/layout/AppLayout.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to a Projects page from the sidebar"
    - "User can see a list of all projects with name, client, status, budget"
    - "User can create a new project with all required fields"
    - "User can view a project detail page showing project info and room list"
    - "Project data persists in the database via Supabase"
  artifacts:
    - path: "material-price-intel/src/hooks/useProjects.ts"
      provides: "React Query hooks for project CRUD"
      exports: ["useProjects", "useProject", "useCreateProject", "useUpdateProject"]
    - path: "material-price-intel/src/pages/ProjectsListPage.tsx"
      provides: "Projects list with status badges and budget info"
      min_lines: 80
    - path: "material-price-intel/src/pages/ProjectCreatePage.tsx"
      provides: "Project creation form"
      min_lines: 60
    - path: "material-price-intel/src/pages/ProjectDetailPage.tsx"
      provides: "Project detail view with summary cards and room list shell"
      min_lines: 100
  key_links:
    - from: "material-price-intel/src/App.tsx"
      to: "ProjectsListPage, ProjectCreatePage, ProjectDetailPage"
      via: "React Router routes"
      pattern: "/projects"
    - from: "material-price-intel/src/components/layout/AppLayout.tsx"
      to: "/projects"
      via: "NavLink in sidebar"
      pattern: "Projects"
    - from: "material-price-intel/src/hooks/useProjects.ts"
      to: "supabase.from('projects')"
      via: "Supabase client queries"
      pattern: "from.*projects"
---

<objective>
Build the project CRUD layer: hooks, list page, create form, detail page, and navigation integration.

Purpose: Users need to create and manage custom home projects before they can define rooms, selections, and estimates. This is the entry point for all Phase 10 functionality.

Output: Three new pages (list, create, detail), one hooks file, and updated routing/navigation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-estimating-procurement/10-01-SUMMARY.md
@material-price-intel/src/lib/types.ts
@material-price-intel/src/hooks/useMaterials.ts
@material-price-intel/src/pages/DashboardPage.tsx
@material-price-intel/src/pages/QuotesListPage.tsx
@material-price-intel/src/App.tsx
@material-price-intel/src/components/layout/AppLayout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useProjects hooks and wire routing/navigation</name>
  <files>
    material-price-intel/src/hooks/useProjects.ts
    material-price-intel/src/App.tsx
    material-price-intel/src/components/layout/AppLayout.tsx
  </files>
  <action>
**Create useProjects.ts** following the exact pattern of useMaterials.ts (React Query + Supabase):

1. `useProjects()` - Fetches all projects for current org, ordered by updated_at desc.
   - queryKey: ["projects"]
   - staleTime: 5 * 60 * 1000
   - Select all columns

2. `useProject(projectId: string | undefined)` - Fetches single project by ID.
   - queryKey: ["projects", projectId]
   - enabled: !!projectId
   - staleTime: 5 * 60 * 1000

3. `useCreateProject()` - Mutation to create a project.
   - Takes: { name, address?, city?, state?, square_footage?, client_name?, client_email?, client_phone?, target_budget?, notes?, start_date?, estimated_completion? }
   - Must get organization_id from user_profiles: query supabase.from('user_profiles').select('organization_id').eq('id', user.id).single() -- get the auth user's id from supabase.auth.getUser()
   - Inserts into projects table with organization_id
   - On success: invalidate ["projects"] query, return the created project
   - Returns the mutation result so the caller can read data.id for navigation

4. `useUpdateProject()` - Mutation to update a project.
   - Takes: { id: string, updates: Partial<Project> }
   - Updates the project row
   - On success: invalidate ["projects"] and ["projects", id]

5. `useDeleteProject()` - Mutation to delete a project.
   - Takes: projectId string
   - Deletes the project (CASCADE will handle rooms/selections/procurement)
   - On success: invalidate ["projects"]

**Update App.tsx** - Add three new routes inside the ProtectedRoute + AppLayout group:
```tsx
<Route path="/projects" element={<ProjectsListPage />} />
<Route path="/projects/new" element={<ProjectCreatePage />} />
<Route path="/projects/:id" element={<ProjectDetailPage />} />
```
Import the three new page components at the top.

**Update AppLayout.tsx** - Add "Projects" to the navItems array. Place it after "Reports" (last current item). Use the `FolderKanban` icon from lucide-react (import it). The route is "/projects".
  </action>
  <verify>
1. `cd material-price-intel && npx tsc --noEmit` passes
2. All 5 hooks exported from useProjects.ts
3. App.tsx has all 3 new routes
4. AppLayout.tsx shows Projects in sidebar nav
  </verify>
  <done>Hooks compile, routes defined, navigation link visible in sidebar.</done>
</task>

<task type="auto">
  <name>Task 2: Create ProjectsListPage, ProjectCreatePage, and ProjectDetailPage</name>
  <files>
    material-price-intel/src/pages/ProjectsListPage.tsx
    material-price-intel/src/pages/ProjectCreatePage.tsx
    material-price-intel/src/pages/ProjectDetailPage.tsx
  </files>
  <action>
**ProjectsListPage.tsx** - Follow DashboardPage.tsx patterns (Card, CardContent, Button, Link, lucide icons):

- Page header: "Projects" title with "New Project" button (Link to /projects/new) using Plus icon
- If loading: show Loader2 spinner
- If no projects: show empty state card "No projects yet. Create your first project to start estimating."
- Project list: Grid of Cards (1 col mobile, 2 cols lg). Each card shows:
  - Project name (bold, links to /projects/:id)
  - Client name (muted text)
  - Address line (muted, if exists)
  - Status badge: Use a colored span based on status value:
    - planning: blue-100/blue-800
    - estimating: amber-100/amber-800
    - in_progress: green-100/green-800
    - completed: slate-100/slate-800
    - on_hold: red-100/red-800
  - Target budget (formatted as USD with Intl.NumberFormat)
  - Square footage (formatted with commas + "sqft")
  - "View" button/link to /projects/:id
- Use useProjects() hook

**ProjectCreatePage.tsx** - Standard form page:

- Page header: "New Project" with back link to /projects
- Form fields (all using existing Input and Label components from @/components/ui):
  - name (required) - text input
  - client_name - text input
  - client_email - email input
  - client_phone - tel input
  - address - text input
  - city - text input, defaultValue "Bradenton"
  - state - text input, defaultValue "FL"
  - square_footage - number input
  - target_budget - number input (in dollars)
  - start_date - date input
  - estimated_completion - date input
  - notes - textarea (use plain HTML textarea with Tailwind classes matching Input: "flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm")
- Submit button: "Create Project" with loading state
- Use useCreateProject() mutation
- On success: navigate to /projects/:id using react-router's useNavigate
- Form uses React useState for each field (simple controlled inputs, no form library needed)
- Convert empty strings to null before submitting
- Convert square_footage and target_budget to numbers (parseFloat, or null if empty)

**ProjectDetailPage.tsx** - Project detail view:

- Get project ID from useParams()
- Use useProject(id) to fetch data
- Loading / not found states
- Page header: Project name with status badge, "Edit" button (for future -- just render as disabled placeholder for now)
- Summary cards row (grid 2 cols on sm, 4 cols on lg):
  - Target Budget: formatted USD
  - Square Footage: formatted with sqft
  - Client: client_name
  - Status: status badge
- Project details section: Card showing address, dates, notes
- Rooms section header: "Rooms & Areas" with "Add Room" button (placeholder disabled for now -- Plan 03 will implement)
- Empty rooms placeholder: "Rooms will appear here. Add rooms to start defining material selections."
- This page will be extended in Plan 03 with the actual room management.
  </action>
  <verify>
1. `cd material-price-intel && npx tsc --noEmit` passes
2. Navigate to /projects -- see empty state or list
3. Navigate to /projects/new -- see form
4. Submit form -- project created, redirected to detail page
5. Detail page shows project info with summary cards
  </verify>
  <done>All three pages render correctly. Project creation works end-to-end: form submit saves to Supabase, redirects to detail page showing saved data.</done>
</task>

</tasks>

<verification>
1. Sidebar shows "Projects" navigation link
2. /projects route renders list page
3. /projects/new route renders creation form
4. Creating a project saves to database and redirects to /projects/:id
5. /projects/:id shows project detail with summary cards
6. `npx tsc --noEmit` passes
7. No regressions on existing pages
</verification>

<success_criteria>
- Projects appear in sidebar navigation
- Full CRUD flow: list -> create -> view detail
- Status badges render with appropriate colors
- Budget and sqft formatted as USD/numbers
- Form validates required name field
- React Query caching with 5-min staleTime
- Organization scoping via RLS (no client-side filter needed)
</success_criteria>

<output>
After completion, create `.planning/phases/10-estimating-procurement/10-02-SUMMARY.md`
</output>
