---
phase: 10-estimating-procurement
plan: 07
type: execute
wave: 7
depends_on: ["10-06"]
files_modified:
  - material-price-intel/src/components/projects/SelectionSheet.tsx
  - material-price-intel/src/pages/ProjectDetailPage.tsx
autonomous: true

must_haves:
  truths:
    - "User can generate a printable selection sheet for client review meetings"
    - "Selection sheet shows all rooms, materials, suppliers, and prices in a clean format"
    - "Sheet can be printed via browser print or exported as PDF"
    - "Client-facing format hides internal cost details (shows selections and prices, not variances)"
  artifacts:
    - path: "material-price-intel/src/components/projects/SelectionSheet.tsx"
      provides: "Printable selection summary component"
      min_lines: 100
  key_links:
    - from: "material-price-intel/src/components/projects/SelectionSheet.tsx"
      to: "useProjectSelections, useProjectRooms"
      via: "Data hooks for selections and rooms"
      pattern: "useProjectSelections|useProjectRooms"
    - from: "material-price-intel/src/pages/ProjectDetailPage.tsx"
      to: "SelectionSheet"
      via: "Print/export button opens selection sheet"
      pattern: "<SelectionSheet|SelectionSheet"
---

<objective>
Build a client-facing selection sheet that can be printed or exported for review meetings with homeowners.

Purpose: Builders meet with clients regularly to review material selections. The builder needs a clean, professional document showing "here's what we've selected for your home, here's what it costs, here's where you're upgrading." This is NOT an internal variance report -- it's client-facing.

Output: SelectionSheet component with print styling, integrated into ProjectDetailPage.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-estimating-procurement/10-01-SUMMARY.md
@.planning/phases/10-estimating-procurement/10-03-SUMMARY.md
@material-price-intel/src/lib/types.ts
@material-price-intel/src/hooks/useProjectSelections.ts
@material-price-intel/src/hooks/useProjectRooms.ts
@material-price-intel/src/pages/ProjectDetailPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SelectionSheet component with print styling</name>
  <files>material-price-intel/src/components/projects/SelectionSheet.tsx</files>
  <action>
Create a print-optimized selection sheet component. This component has two modes:
1. Displayed inline on the page (for preview)
2. Printed via window.print() with @media print styles

Props:
```typescript
type SelectionSheetProps = {
  projectId: string;
  project: Project;
  showPricing: boolean;  // toggle to hide/show dollar amounts
};
```

**Data fetching:**
- useProjectRooms(projectId)
- useProjectSelections(projectId)
- Group selections by room_id

**Layout (professional document format):**

1. **Header:**
   - Company: "Ross Built Custom Homes" (hardcoded, or from organization name)
   - "Material Selection Sheet" (title)
   - Project name (bold, large)
   - Client name
   - Address
   - Date generated: formatted current date
   - Square footage

2. **Room sections** (one per room, in sort_order):
   - Room name as section header (e.g., "Kitchen", "Master Bath")
   - Table for that room's selections:
     - Columns: Item | Material | Supplier | Qty | Unit | Unit Price | Total | Status
     - Item = selection_name
     - Material = material canonical_name or description (or "TBD" if not selected)
     - Supplier = supplier name (or "--")
     - Qty = quantity (formatted)
     - Unit Price = actual_unit_price if available, else estimated_unit_price
     - Total = actual_total if available, else estimated_total
     - Status = upgrade_status badge text: "Standard", "Upgrade (+$X,XXX)", "Downgrade (-$X,XXX)", "Pending"
       - Upgrade amount = actual_total - allowance_amount (or estimated_total - allowance_amount)
   - Room subtotal row at bottom of each room table

3. **Summary section** at bottom:
   - Total allowances
   - Total selections cost (actual where available, estimated otherwise)
   - Net upgrade/downgrade amount
   - "Amounts shown are estimates and subject to change" disclaimer

4. **Signature lines** at bottom:
   - "Approved by: ________________________  Date: ________"
   - "Builder: ________________________  Date: ________"

**Pricing toggle:**
- When showPricing is false: hide Unit Price, Total columns, and all dollar amounts
- Show only: Item, Material, Supplier, Qty, Unit, Status (without dollar amounts in status)
- This is for early-stage selections where pricing isn't finalized

**Print styles:**
- Add a @media print CSS block (either via a style tag in the component or by adding print styles to index.css):
  - Hide sidebar navigation, header, tabs, buttons (everything outside the SelectionSheet)
  - Use `@media print { .no-print { display: none !important; } }`
  - Set white background, black text
  - Page breaks: `break-inside: avoid` on room sections
  - Reasonable margins
  - Font size: 11px for body, 14px for headers
  - Table borders visible (use border-collapse: collapse, 1px solid #ddd)

**On-screen styling:**
- White background card with subtle border
- Same layout as print but within the app's normal chrome
- "Print" button and "Hide Pricing" toggle are shown on screen but hidden in print
  </action>
  <verify>
1. `cd material-price-intel && npx tsc --noEmit` passes
2. Component renders all rooms with selections in table format
3. Pricing toggle hides/shows dollar columns
4. Print preview (Ctrl+P) shows clean document without app chrome
5. Room sections don't break across pages
6. Upgrade/downgrade status shows with dollar amounts
  </verify>
  <done>Selection sheet renders a professional, print-ready document showing all rooms, materials, and pricing for client review meetings.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate SelectionSheet into ProjectDetailPage</name>
  <files>material-price-intel/src/pages/ProjectDetailPage.tsx</files>
  <action>
Add SelectionSheet as a fourth tab on the ProjectDetailPage.

**Tab updates:**
- Add "Selection Sheet" tab after "Budget"
- Tab order: "Rooms & Selections" | "Procurement" | "Budget" | "Selection Sheet"
- Use the Printer icon from lucide-react for the tab

**Selection Sheet tab content:**
- Render SelectionSheet component with projectId and project data
- Above the sheet, show a toolbar with:
  - "Print" button (calls window.print())
  - "Show Pricing" toggle (checkbox or switch, defaults to true)
  - "Date: [current date]" label
- Add the CSS class "no-print" to:
  - The sidebar (AppLayout)
  - The tab navigation
  - The toolbar above the selection sheet
- The SelectionSheet itself should NOT have the "no-print" class

**Print CSS (add to index.css):**
```css
@media print {
  .no-print {
    display: none !important;
  }
  body {
    background: white;
  }
  main {
    padding: 0 !important;
  }
}
```

Note: The AppLayout sidebar needs the "no-print" class added. Update AppLayout.tsx to add `className="no-print"` to the aside element (merge with existing classes). Similarly, the main element's padding should be 0 in print mode (handled by the CSS rule above).

**Additional files to modify:**
- material-price-intel/src/components/layout/AppLayout.tsx -- add "no-print" class to the aside sidebar element
- material-price-intel/src/index.css -- add @media print rules
  </action>
  <verify>
1. `cd material-price-intel && npx tsc --noEmit` passes
2. "Selection Sheet" tab visible on ProjectDetailPage
3. Sheet renders with all room/selection data
4. "Print" button triggers browser print dialog
5. Print preview shows only the selection sheet (no sidebar, no tabs)
6. "Show Pricing" toggle hides/shows dollar amounts
7. Existing tabs still work correctly
  </verify>
  <done>Selection sheet tab integrated into ProjectDetailPage with print support and pricing toggle. Builders can print client-facing selection summaries directly from the app.</done>
</task>

</tasks>

<verification>
1. Selection Sheet tab renders on ProjectDetailPage
2. Sheet shows all rooms grouped with their selections
3. Pricing toggle works (hides/shows dollar columns)
4. Browser print (Ctrl+P) produces clean document
5. Print output has no app chrome (sidebar, tabs, buttons hidden)
6. Room sections avoid page breaks
7. Upgrade/downgrade status clearly indicated
8. Signature lines at bottom for client approval
9. `npx tsc --noEmit` passes
</verification>

<success_criteria>
- Professional, client-facing document format
- All rooms and selections displayed in organized tables
- Print output clean and ready for meetings
- Pricing toggle for early-stage reviews without dollar amounts
- Upgrade/downgrade status visible with dollar impact
- Signature lines for formal approval
</success_criteria>

<output>
After completion, create `.planning/phases/10-estimating-procurement/10-07-SUMMARY.md`
</output>
