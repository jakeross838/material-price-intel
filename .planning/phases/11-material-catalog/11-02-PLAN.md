---
phase: 11-material-catalog
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - material-price-intel/src/hooks/useCatalog.ts
  - material-price-intel/src/hooks/useMaterialImages.ts
  - material-price-intel/src/hooks/useMaterialDocuments.ts
  - material-price-intel/src/lib/roomCategoryDefaults.ts
autonomous: true

must_haves:
  truths:
    - "Hook fetches room-category mappings with joined category data"
    - "Hook fetches material images for a given material"
    - "Hook supports uploading images to material-catalog storage bucket"
    - "Hook fetches material documents with CRUD operations"
    - "Room type display names and labels are defined for all 10 room types"
  artifacts:
    - path: "material-price-intel/src/hooks/useCatalog.ts"
      provides: "React Query hooks for catalog browsing: room mappings, catalog materials"
      exports: ["useRoomCategoryMappings", "useCatalogMaterials", "useRoomTypes"]
    - path: "material-price-intel/src/hooks/useMaterialImages.ts"
      provides: "CRUD hooks for material-level images"
      exports: ["useMaterialImages", "useAddMaterialImage", "useUploadMaterialImage", "useDeleteMaterialImage", "useSetPrimaryMaterialImage"]
    - path: "material-price-intel/src/hooks/useMaterialDocuments.ts"
      provides: "CRUD hooks for material documents"
      exports: ["useMaterialDocuments", "useAddMaterialDocument", "useDeleteMaterialDocument"]
    - path: "material-price-intel/src/lib/roomCategoryDefaults.ts"
      provides: "Room type display names, icons, and descriptions"
      exports: ["ROOM_TYPE_CONFIG", "ROOM_TYPES"]
  key_links:
    - from: "useCatalog.ts"
      to: "supabase"
      via: "supabase.from('room_category_mapping')"
      pattern: "from\\(['\"]room_category_mapping['\"]\\)"
    - from: "useMaterialImages.ts"
      to: "supabase"
      via: "supabase.from('material_images')"
      pattern: "from\\(['\"]material_images['\"]\\)"
    - from: "useMaterialDocuments.ts"
      to: "supabase"
      via: "supabase.from('material_documents')"
      pattern: "from\\(['\"]material_documents['\"]\\)"
---

<objective>
Create all React Query hooks and data utilities for the material catalog. This is the data layer that Plan 03 (catalog UI) and Plan 04 (public endpoint) will consume.

Purpose: Separate the data-fetching layer from the UI layer for clean architecture. These hooks follow established patterns (5-min staleTime, React Query mutations with cache invalidation).

Output: Four source files providing catalog data access, material image CRUD, material document CRUD, and room-type configuration constants.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-material-catalog/11-01-SUMMARY.md

@material-price-intel/src/hooks/useMaterials.ts
@material-price-intel/src/hooks/useSelectionImages.ts
@material-price-intel/src/hooks/useProductData.ts
@material-price-intel/src/lib/types.ts
@material-price-intel/src/lib/supabase.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create room-category config and catalog hooks</name>
  <files>material-price-intel/src/lib/roomCategoryDefaults.ts, material-price-intel/src/hooks/useCatalog.ts</files>
  <action>
**roomCategoryDefaults.ts:**

Create a configuration file defining room types with display metadata:

```typescript
export const ROOM_TYPES = [
  'kitchen', 'master_bath', 'bathroom', 'great_room', 'bedroom',
  'dining_room', 'office', 'laundry', 'garage', 'exterior',
] as const;

export type CatalogRoomType = typeof ROOM_TYPES[number];

export const ROOM_TYPE_CONFIG: Record<CatalogRoomType, {
  displayName: string;
  description: string;
  icon: string; // lucide icon name for reference
}> = {
  kitchen: { displayName: 'Kitchen', description: 'Cabinets, countertops, backsplash, flooring, fixtures', icon: 'ChefHat' },
  master_bath: { displayName: 'Master Bath', description: 'Tile, vanities, fixtures, plumbing, mirrors', icon: 'Bath' },
  bathroom: { displayName: 'Bathroom', description: 'Tile, fixtures, plumbing, vanity', icon: 'ShowerHead' },
  great_room: { displayName: 'Great Room', description: 'Flooring, lighting, windows, paint', icon: 'Sofa' },
  bedroom: { displayName: 'Bedroom', description: 'Flooring, lighting, windows, paint', icon: 'Bed' },
  dining_room: { displayName: 'Dining Room', description: 'Flooring, lighting, windows, paint', icon: 'UtensilsCrossed' },
  office: { displayName: 'Office', description: 'Flooring, lighting, paint', icon: 'Monitor' },
  laundry: { displayName: 'Laundry', description: 'Tile, plumbing, cabinets, fixtures', icon: 'WashingMachine' },
  garage: { displayName: 'Garage', description: 'Flooring, paint', icon: 'Car' },
  exterior: { displayName: 'Exterior', description: 'Roofing, windows, siding, landscaping', icon: 'Home' },
};
```

**useCatalog.ts:**

Create React Query hooks for catalog browsing:

1. `useRoomCategoryMappings(roomType?: string)` - Fetches room_category_mapping with joined material_categories data. If roomType provided, filters to that room. staleTime 30 minutes (mappings rarely change). Returns array of { id, room_type, sort_order, material_categories: { id, name, display_name, sort_order } }.

2. `useCatalogMaterials(categoryId?: string)` - Fetches materials with joined material_images (select first 3) and material_categories. If categoryId provided, filters by category. Only fetches is_active=true. staleTime 5 minutes. Uses Supabase anonymous client (no auth required for public catalog). Returns materials with their primary image and category info.

3. `useRoomTypes()` - Simple utility hook that returns the ROOM_TYPES array and config. This is not a query â€” just returns the static config. Alternatively, query room_category_mapping for DISTINCT room_type to show only room types that have mappings.

4. `useCatalogMaterialDetail(materialId: string)` - Fetches a single material with ALL images, ALL documents, and category data. For the detail/gallery view. staleTime 5 minutes.

Follow existing patterns from useMaterials.ts and useSelectionImages.ts. Use `supabase` from `@/lib/supabase`. Use `type` for derived types (e.g., `CatalogMaterial`, `CatalogMaterialDetail`).

IMPORTANT: These hooks will be used both in authenticated admin context AND in public catalog pages. The public SELECT RLS policies from Plan 01 allow anonymous reads on materials, material_images, material_documents, material_categories, and room_category_mapping. No auth check needed in the hooks themselves.
  </action>
  <verify>Run `cd material-price-intel && npx tsc --noEmit` to verify types compile. Verify hooks export the documented functions.</verify>
  <done>roomCategoryDefaults.ts exports ROOM_TYPES and ROOM_TYPE_CONFIG. useCatalog.ts exports useRoomCategoryMappings, useCatalogMaterials, useRoomTypes, useCatalogMaterialDetail. TypeScript compiles.</done>
</task>

<task type="auto">
  <name>Task 2: Create material image and document CRUD hooks</name>
  <files>material-price-intel/src/hooks/useMaterialImages.ts, material-price-intel/src/hooks/useMaterialDocuments.ts</files>
  <action>
**useMaterialImages.ts:**

Follow the exact pattern from useSelectionImages.ts but for material_images table:

1. `useMaterialImages(materialId: string | undefined)` - Fetches all images for a material, ordered by is_primary DESC, sort_order ASC. staleTime 5 minutes. Enabled only when materialId is truthy.

2. `useAddMaterialImage()` - Mutation to insert a material_images record. Input: { material_id, image_url, thumbnail_url?, caption?, source?, is_primary?, metadata? }. If is_primary, unset existing primary first (same pattern as selection images). Cache invalidation on ["material_images", material_id].

3. `useUploadMaterialImage()` - Mutation to upload a file to 'material-catalog' storage bucket then create the DB record. Input: { materialId, orgId, file: File, isPrimary? }. Storage path: `{orgId}/{materialId}/{crypto.randomUUID()}.{ext}`. After upload, get public URL and insert DB record. Same pattern as useUploadSelectionImage in useSelectionImages.ts.

4. `useSetPrimaryMaterialImage()` - Mutation: unset all primary for material, set new primary. Input: { imageId, materialId }. Cache invalidation on ["material_images", materialId].

5. `useDeleteMaterialImage()` - Mutation: delete from storage if storagePath exists, then delete DB record. Input: { imageId, materialId, storagePath? }. Cache invalidation.

6. `getMaterialImageDisplayUrl(image: MaterialImage): string | null` - Helper function, same logic as getImageDisplayUrl but for MaterialImage type. Checks external_url, then thumbnail_url, then storage_path.

**useMaterialDocuments.ts:**

1. `useMaterialDocuments(materialId: string | undefined)` - Fetches all documents for a material, ordered by doc_type, then title. staleTime 5 minutes.

2. `useAddMaterialDocument()` - Mutation to insert a material_documents record. Input: { material_id, title, doc_url, doc_type?, storage_path?, metadata? }. Cache invalidation on ["material_documents", material_id].

3. `useDeleteMaterialDocument()` - Mutation to delete a document record (and storage file if storagePath). Input: { docId, materialId, storagePath? }. Cache invalidation.

All hooks import `supabase` from `@/lib/supabase`, types from `@/lib/types`, and follow existing query key patterns.
  </action>
  <verify>Run `cd material-price-intel && npx tsc --noEmit` to verify types compile. Grep for exported function names to confirm all hooks exist.</verify>
  <done>useMaterialImages.ts exports 6 items (5 hooks + 1 helper). useMaterialDocuments.ts exports 3 hooks. TypeScript compiles. All follow existing React Query patterns with 5-min staleTime and proper cache invalidation.</done>
</task>

</tasks>

<verification>
- [ ] roomCategoryDefaults.ts defines all 10 room types with display names
- [ ] useCatalog.ts hooks fetch room mappings and catalog materials
- [ ] useMaterialImages.ts has full CRUD + upload + display URL helper
- [ ] useMaterialDocuments.ts has read + add + delete
- [ ] All hooks follow 5-min staleTime convention
- [ ] All hooks use React Query mutation pattern with cache invalidation
- [ ] `npx tsc --noEmit` passes
</verification>

<success_criteria>
Data layer for the material catalog is complete. Catalog browse queries work for both authenticated (admin) and anonymous (public) contexts. Material image and document CRUD operations follow the same patterns as the existing selection_images hooks. Room type configuration provides display metadata for the room-by-room selection flow in Phase 12.
</success_criteria>

<output>
After completion, create `.planning/phases/11-material-catalog/11-02-SUMMARY.md`
</output>
