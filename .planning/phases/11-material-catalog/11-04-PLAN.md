---
phase: 11-material-catalog
plan: 04
type: execute
wave: 3
depends_on: ["11-02", "11-03"]
files_modified:
  - material-price-intel/src/pages/CatalogPage.tsx
  - material-price-intel/src/pages/CatalogDetailPage.tsx
  - material-price-intel/src/pages/AdminCatalogPage.tsx
  - material-price-intel/src/App.tsx
autonomous: false

must_haves:
  truths:
    - "Public catalog page shows materials as visual cards browseable by category"
    - "Material detail page shows full image gallery, specs, and documents"
    - "Admin page allows uploading images and linking documents to materials"
    - "Catalog is accessible without authentication at /catalog"
    - "Category filter narrows the visible materials"
    - "Room-category grouping available as an alternate browse mode"
  artifacts:
    - path: "material-price-intel/src/pages/CatalogPage.tsx"
      provides: "Public browseable material catalog with category filter and card grid"
      min_lines: 80
    - path: "material-price-intel/src/pages/CatalogDetailPage.tsx"
      provides: "Material detail view with image gallery, specs, and documents"
      min_lines: 60
    - path: "material-price-intel/src/pages/AdminCatalogPage.tsx"
      provides: "Admin page for managing catalog images, documents, and room-category mappings"
      min_lines: 100
    - path: "material-price-intel/src/App.tsx"
      provides: "Updated routes for /catalog, /catalog/:id, and /admin/catalog"
      contains: "CatalogPage"
  key_links:
    - from: "CatalogPage.tsx"
      to: "useCatalogMaterials"
      via: "import from useCatalog"
      pattern: "useCatalogMaterials"
    - from: "CatalogDetailPage.tsx"
      to: "useCatalogMaterialDetail"
      via: "import from useCatalog"
      pattern: "useCatalogMaterialDetail"
    - from: "AdminCatalogPage.tsx"
      to: "useMaterialImages"
      via: "import from useMaterialImages"
      pattern: "useMaterialImages"
    - from: "App.tsx"
      to: "CatalogPage"
      via: "Route element"
      pattern: "path=\"/catalog\""
---

<objective>
Build the catalog pages: a public browseable catalog, a material detail page with gallery, and an admin management page. Wire routes in App.tsx. The public catalog (/catalog and /catalog/:id) does NOT require authentication. The admin page (/admin/catalog) requires auth.

Purpose: This is the final deliverable for Phase 11 -- the visual material catalog that Phase 12's Dream Home Designer will consume. The public endpoint satisfies CATALOG requirement for the estimator to reference materials. The admin page lets Ross Built staff manage catalog content.

Output: Three page components and updated routing.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-material-catalog/11-01-SUMMARY.md
@.planning/phases/11-material-catalog/11-02-SUMMARY.md
@.planning/phases/11-material-catalog/11-03-SUMMARY.md

@material-price-intel/src/App.tsx
@material-price-intel/src/pages/MaterialsPage.tsx
@material-price-intel/src/pages/EstimatePage.tsx
@material-price-intel/src/components/catalog/MaterialCard.tsx
@material-price-intel/src/components/catalog/MaterialImageGallery.tsx
@material-price-intel/src/components/catalog/MaterialDocumentList.tsx
@material-price-intel/src/components/catalog/CategoryFilter.tsx
@material-price-intel/src/hooks/useCatalog.ts
@material-price-intel/src/hooks/useMaterialImages.ts
@material-price-intel/src/hooks/useMaterialDocuments.ts
@material-price-intel/src/lib/roomCategoryDefaults.ts
@material-price-intel/src/lib/categorySpecTemplates.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CatalogPage and CatalogDetailPage (public)</name>
  <files>material-price-intel/src/pages/CatalogPage.tsx, material-price-intel/src/pages/CatalogDetailPage.tsx</files>
  <action>
**CatalogPage.tsx** - Public catalog browse page (no auth required):

Layout:
- Stone blue header area matching EstimatePage branding (Ross Built Custom Homes logo, background gradient). Reference EstimatePage.tsx for the exact branding pattern. Use the same color palette: bg-gradient with stone blue tones (#1e3a5f area).
- Header: "Material Catalog" title, "Browse our curated selection of materials for your custom home" subtitle
- CategoryFilter component immediately below header
- Optional toggle: "Browse by Category" vs "Browse by Room" using button group
- Grid of MaterialCard components: responsive grid (1 col mobile, 2 cols sm, 3 cols md, 4 cols lg)
- Loading state: skeleton grid with shimmer animation
- Empty state when no materials: "No materials in this category yet"

Data flow:
- useRoomCategoryMappings() for room-based browsing
- useCatalogMaterials(activeCategoryId) for category-based browsing
- Fetch material_categories for the CategoryFilter
- State: activeCategoryId (string | null), browseMode ('category' | 'room')
- When browseMode is 'room': show room type grid (cards for Kitchen, Master Bath, etc. from ROOM_TYPE_CONFIG), clicking a room shows its categories, clicking a category within a room shows materials
- When browseMode is 'category': flat category filter + material grid

Navigation:
- Clicking a MaterialCard navigates to `/catalog/{materialId}` using React Router's `useNavigate()`
- "Back to estimator" link in header area

Price range: For each material, query or compute from existing line_items data. Initially, pass priceRange as null (the card handles "Price TBD" display). Getting real price ranges requires an RPC or join that can be added later without changing the component API.

IMPORTANT: This page renders OUTSIDE the ProtectedRoute, same pattern as EstimatePage. It uses the Supabase anonymous client (no auth) and relies on public SELECT RLS policies.

**CatalogDetailPage.tsx** - Material detail page (public, no auth):

Layout:
- Same stone blue header as CatalogPage (lighter/smaller version)
- Back button: "Back to Catalog" link
- Two-column layout on desktop (gallery left 60%, info right 40%), single column mobile
- Left column: MaterialImageGallery component
- Right column:
  - Material name (h1, text-2xl font-bold)
  - Category badge
  - Species, dimensions, grade, treatment as detail rows (label: value pairs)
  - Key specs from category_attributes using getPrioritizedSpecs
  - Price range (if available, else "Contact for pricing")
- Below two columns: MaterialDocumentList (full width)
- "Get a Quote" CTA button linking back to /estimate

Data flow:
- Get materialId from URL params: `useParams()`
- useCatalogMaterialDetail(materialId) for the full material with images, documents, category
- Loading state: centered spinner
- Not found state: "Material not found" message with back link
  </action>
  <verify>
    Run `cd material-price-intel && npx tsc --noEmit` to verify compilation.
    Verify CatalogPage imports and renders MaterialCard, CategoryFilter.
    Verify CatalogDetailPage imports and renders MaterialImageGallery, MaterialDocumentList.
  </verify>
  <done>CatalogPage shows browseable material grid with category filter and room browse mode. CatalogDetailPage shows full material detail with image gallery, specs, and documents. Both pages work without authentication. TypeScript compiles.</done>
</task>

<task type="auto">
  <name>Task 2: Create AdminCatalogPage</name>
  <files>material-price-intel/src/pages/AdminCatalogPage.tsx</files>
  <action>
**AdminCatalogPage.tsx** - Admin page for managing catalog content (auth required):

Layout:
- Standard admin page layout (same as AdminEstimatorPage pattern -- inside AppLayout)
- Page title: "Catalog Management"
- Tab navigation (local state, same pattern as ProjectDetailPage): "Materials", "Room Mappings"

**Materials Tab:**
- Material selector: dropdown or search to pick a material from useMaterials()
- Once a material is selected, show:
  1. **Images section**: Grid of current images from useMaterialImages(materialId). Below grid: "Add Image" controls:
     - URL paste input + "Add" button (calls useAddMaterialImage)
     - File upload button (calls useUploadMaterialImage)
     - Each image has hover controls: set primary (star), delete (trash)
  2. **Documents section**: List from useMaterialDocuments(materialId). Below list: "Add Document" form:
     - Title input
     - URL input
     - Doc type dropdown (spec_sheet, installation_guide, cut_sheet, warranty, care_guide, other)
     - "Add" button (calls useAddMaterialDocument)
     - Each document has a delete button
  3. **Import from Product URL**: If the material has few images/documents, show a convenience import bridge from the existing product_data scraper:
     - URL input + "Import" button
     - Calls supabase.functions.invoke('scrape-product', { body: { url, category_name } })
     - Maps productData.images to material_images inserts (useAddMaterialImage for each)
     - Maps productData.documents to material_documents inserts (useAddMaterialDocument for each)
     - Show progress/results: "Imported N images and M documents"
     - Handle errors gracefully (toast notification on failure)

**Room Mappings Tab:**
- Grid of room types (from ROOM_TYPE_CONFIG)
- Each room shows its currently mapped categories as removable pills
- Dropdown to add a new category to a room
- Direct Supabase insert/delete on room_category_mapping table
- Use useRoomCategoryMappings() to fetch current state
- Inline mutations (no separate hook needed for simple insert/delete)

Fetch orgId from user_profiles (same pattern as MaterialsPage useOrgId).
  </action>
  <verify>
    Run `cd material-price-intel && npx tsc --noEmit` to verify compilation.
    Verify AdminCatalogPage imports useMaterialImages, useMaterialDocuments, useRoomCategoryMappings, useMaterials.
  </verify>
  <done>AdminCatalogPage provides material image/document management with manual add and scraper import, plus room-category mapping editor. TypeScript compiles.</done>
</task>

<task type="auto">
  <name>Task 3: Wire routes in App.tsx and add sidebar navigation</name>
  <files>material-price-intel/src/App.tsx</files>
  <action>
Add three new routes to App.tsx:

```tsx
// Public catalog routes (OUTSIDE ProtectedRoute, same level as /estimate)
<Route path="/catalog" element={<CatalogPage />} />
<Route path="/catalog/:id" element={<CatalogDetailPage />} />

// Admin catalog route (INSIDE ProtectedRoute > AppLayout)
<Route path="/admin/catalog" element={<AdminCatalogPage />} />
```

Add lazy imports for CatalogPage, CatalogDetailPage, AdminCatalogPage at top of App.tsx.

Also add a navigation link to the catalog admin in the AppLayout sidebar/nav. Check the layout component for where nav items are defined and add an entry for "Catalog" under the admin section, using the Palette or Grid3x3 icon from lucide.
  </action>
  <verify>
    Run `cd material-price-intel && npx tsc --noEmit` to verify compilation.
    Run `cd material-price-intel && npm run build` to verify the full build succeeds.
    Verify App.tsx has /catalog, /catalog/:id, and /admin/catalog routes.
    Verify sidebar/nav includes a "Catalog" link pointing to /admin/catalog.
  </verify>
  <done>App.tsx routes /catalog and /catalog/:id as public (outside ProtectedRoute), /admin/catalog as authenticated. Sidebar navigation includes Catalog link. Full build passes.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete material catalog with:
    1. Public catalog page at /catalog showing material cards browseable by category and room
    2. Material detail page at /catalog/:id with image gallery, specs, and documents
    3. Admin catalog management page at /admin/catalog for uploading images, linking documents, and managing room-category mappings
    4. Database schema with material_images, material_documents, and room_category_mapping tables
  </what-built>
  <how-to-verify>
    1. Run `cd material-price-intel && npm run dev`
    2. Visit http://localhost:5173/catalog (should load without login)
    3. Verify: Category filter shows, materials display as visual cards (may be empty initially if no catalog data populated)
    4. Toggle between "Browse by Category" and "Browse by Room" modes
    5. Log in and visit http://localhost:5173/admin/catalog
    6. Select a material, try adding an image URL and a document URL
    7. Try "Import from Product URL" with a real product URL (e.g., Home Depot link)
    8. Visit the Room Mappings tab, verify room types show with their categories
    9. Go back to /catalog and verify the material now shows with its image
    10. Click a material card to see the detail page at /catalog/:id
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- [ ] /catalog loads without authentication, shows material cards
- [ ] /catalog/:id shows material detail with gallery and documents
- [ ] /admin/catalog requires auth, allows image/document management
- [ ] Category filter narrows materials
- [ ] Room-based browsing shows room types and their categories
- [ ] Image upload works (URL paste and file upload)
- [ ] Document linking works
- [ ] Import from Product URL maps scraped images and documents to material_images/material_documents
- [ ] Room-category mapping editable in admin
- [ ] Ross Built branding on public pages
- [ ] Sidebar navigation includes Catalog link
- [ ] Full build passes: `npm run build`
</verification>

<success_criteria>
Phase 11 complete: A fully functional material catalog with public browsing, material detail pages with image galleries and documents, admin management, and room-category organization. The catalog is ready to be consumed by Phase 12's Dream Home Designer room-by-room selection flow. Materials are tagged with room-appropriate categories. Public endpoint requires no auth. All four CATALOG requirements (01-04) satisfied.
</success_criteria>

<output>
After completion, create `.planning/phases/11-material-catalog/11-04-SUMMARY.md`
</output>
